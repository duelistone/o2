// board.c

#include "board.h"
#include <stdlib.h>
#include <stdio.h>
#include <math.h>

// Global variable needed for eval function
// Designed so that entry at 35 * i + j is 1 - (1 - abs(i - j - 1) / 100.0) ** (2 ** ((35 - i - j) / 50.0))
double mobilityConstant[35 * 35] = {
0.016194258665640615, 0.031849337323286986, 0.04698826768882014, 0.061632958618885625, 0.07580426107412375, 0.08952202897193784, 0.10280517621985785, 0.1156717301985154, 0.1281388819430309, 0.14022303325305097, 0.1519398409446454, 0.16330425844162455, 0.17433057488946346, 0.18503245196181317, 0.19542295851743763, 0.20551460325425264, 0.21531936549688568, 0.22484872424473745, 0.2341136855988586, 0.2431248086779777, 0.25189223012670503, 0.2604256873122016, 0.26873454029944355, 0.2768277926895565, 0.2847141114005203, 0.2924018454648216, 0.29989904391432753, 0.30721347281873934, 0.31435263154045223, 0.3213237682654606, 0.3281338948671061, 0.3347898011569438, 0.3412980685748024, 0.34766508336821544, 0.35389704930981636, 0.0, 0.015754932936872357, 0.030992054960794935, 0.045733217141002314, 0.05999921947468034, 0.07380987105334014, 0.0871840464668322, 0.10013973870882209, 0.11269410882778919, 0.12486353254947102, 0.13666364408000942, 0.14810937728375462, 0.15921500441560665, 0.16999417257484573, 0.18045993803550386, 0.1906247985973959, 0.20050072409186415, 0.21009918516703407, 0.21943118046886867, 0.2285072623264781, 0.23733756104294101, 0.24593180788628966, 0.2542993568692259, 0.2624492054005747, 0.2703900138863711, 0.27813012435381146, 0.2856775781670394, 0.2930401328998541, 0.3002252784269185, 0.30724025229186536, 0.3140920544078526, 0.32078746114358403, 0.32733303884557974, 0.3337351568455398, 0.3400000000000001, 0.015754932936872357, 0.0, 0.015327432383523854, 0.030157486778307985, 0.0445109003971742, 0.0584074262508667, 0.07186588889671763, 0.08490423674199299, 0.09753959114119515, 0.10978829250887001, 0.12166594365318262, 0.13318745052055736, 0.14436706052791826, 0.15521839864640552, 0.1657545013888, 0.17598784884217733, 0.18593039487744656, 0.1955935956583622, 0.20498843656424015, 0.21412545763292867, 0.22301477762351496, 0.23166611679174565, 0.2400888184651695, 0.2482918694995232, 0.25628391969284725, 0.2640733002292195, 0.2716680412197705, 0.2790758884048167, 0.28630431907744613, 0.29336055728573895, 0.30025158836795585, 0.3069841728724857, 0.3135648599120886, 0.32000000000000006, 0.32629575741376293, 0.030992054960794935, 0.015327432383523854, 0.0, 0.014911443720669881, 0.029345050345436885, 0.04332050595984005, 0.05685657475721184, 0.06997115071710225, 0.08268130612727209, 0.09500333716639608, 0.10695280674870067, 0.11854458481714214, 0.12979288625827157, 0.140711306599559, 0.15131285563855457, 0.1616099891427757, 0.17161463874955873, 0.18133824018621714, 0.1907917599226675, 0.19998572036114393, 0.2089302236606846, 0.21763497428769207, 0.2261093003779937, 0.2343621739904359, 0.24240223032708952, 0.25023778599060065, 0.2578768563450641, 0.2653271720429976, 0.27259619477753494, 0.27969113231581777, 0.28661895286672934, 0.29338639883356965, 0.30000000000000004, 0.3064660861955927, 0.31279079948558064, 0.045733217141002314, 0.030157486778307985, 0.014911443720669881, 0.0, 0.014506661692845979, 0.02855417711825614, 0.04216124016297973, 0.05534568090117231, 0.06812451352114024, 0.08051398135901511, 0.09252959923652337, 0.10418619328572643, 0.11549793843046885, 0.12647839368216696, 0.13714053539643745, 0.1474967886268035, 0.157559056702266, 0.167338749146825, 0.17684680805101682, 0.18609373299814347, 0.19508960464106861, 0.20384410701918831, 0.2123665486994185, 0.22066588281973554, 0.22875072610893554, 0.23662937695179953, 0.24430983256475158, 0.25179980534334645, 0.2591067384394986, 0.2662378206232491, 0.2732000004810501, 0.28, 0.2866443275851934, 0.29313929055533106, 0.2994910071599697, 0.05999921947468034, 0.0445109003971742, 0.029345050345436885, 0.014506661692845979, 0.0, 0.014112788882979954, 0.02778431216593169, 0.04103232690774672, 0.05387378050882086, 0.06632485517829634, 0.07840100974843422, 0.09011701901524793, 0.1014870107716952, 0.11252450068790854, 0.12324242518205786, 0.13365317241541086, 0.14376861153591558, 0.15360012028611103, 0.16315861108332252, 0.1724545556728604, 0.1814980084482759, 0.1902986285265802, 0.19886570066067677, 0.20720815506604517, 0.21533458623392387, 0.2232532707988386, 0.2309721845242778, 0.23849901846661892, 0.24584119437402252, 0.2530058793739304, 0.26, 0.26683025560677776, 0.27350313121813863, 0.2800249098534928, 0.2864016843739743, 0.07380987105334014, 0.0584074262508667, 0.04332050595984005, 0.02855417711825614, 0.014112788882979954, 0.0, 0.013729535525050296, 0.02703491389937729, 0.039933007394268416, 0.05243992913273676, 0.06457107436534582, 0.07634115931234098, 0.08776425773493368, 0.09885383538704273, 0.10962278248817314, 0.12008344434830642, 0.13024765026665042, 0.14012674081776355, 0.1497315936308884, 0.1590726477612473, 0.1681599267455226, 0.17700306042772096, 0.18561130563607242, 0.1939935657865055, 0.20215840948352792, 0.2101140881850172, 0.21786855299344976, 0.22542947063244279, 0.23280423866415034, 0.24, 0.24702365675448057, 0.2538818834891784, 0.26058113989198517, 0.2671276829343724, 0.27352757854782295, 0.0871840464668322, 0.07186588889671763, 0.05685657475721184, 0.04216124016297973, 0.02778431216593169, 0.013729535525050296, 0.0, 0.013356619320445517, 0.02630545380215421, 0.0388625398501844, 0.051043201848028574, 0.06286209048809599, 0.07433321886859079, 0.08546999650491072, 0.0962852613933145, 0.10679131025503885, 0.11699992708022067, 0.12692241008284255, 0.13656959717040607, 0.14595189002511333, 0.15507927688694034, 0.16396135412309232, 0.17260734666289335, 0.1810261273721453, 0.1892262354363774, 0.19721589381815208, 0.20500302584968133, 0.21259527101841935, 0.21999999999999997, 0.22722432898987766, 0.234275133382281, 0.24115906084259242, 0.24788254381700447, 0.2544518115212786, 0.26087290144861297, 0.10013973870882209, 0.08490423674199299, 0.06997115071710225, 0.05534568090117231, 0.04103232690774672, 0.02703491389937729, 0.013356619320445517, 0.0, 0.012993765257999002, 0.025595416163812335, 0.03782019925651803, 0.04968269303759054, 0.06119684358200661, 0.07237599809849116, 0.08323293657372044, 0.09377990162595906, 0.10402862668499313, 0.11399036260727069, 0.12367590282782503, 0.13309560714377777, 0.14225942421796955, 0.1511769128854954, 0.15985726234059439, 0.1683093112764309, 0.1765415660457771, 0.18456221790642902, 0.19237915941135053, 0.19999999999999996, 0.2074320808440594, 0.21468248899780662, 0.22175807090065802, 0.22866544527693566, 0.2354110154756669, 0.24200098129119918, 0.24844135030359926, 0.11269410882778919, 0.09753959114119515, 0.08268130612727209, 0.06812451352114024, 0.05387378050882086, 0.039933007394268416, 0.02630545380215421, 0.012993765257999002, 0.0, 0.012640705437667377, 0.024904297815852017, 0.03680527707143788, 0.04835751616763695, 0.05957429419329541, 0.07046832757832522, 0.08105179954803277, 0.09133638793071164, 0.10133329142510639, 0.11105325442718272, 0.12050659050902635, 0.12970320463657847, 0.1386526142072687, 0.14736396898339943, 0.1558460699923211, 0.16410738745999864, 0.17215607784048026, 0.17999999999999994, 0.18764673061098236, 0.19510357880801898, 0.20237760015496198, 0.20947560996959846, 0.21640419604992034, 0.22316973084378056, 0.22977838310170873, 0.23623612905084923, 0.12486353254947102, 0.10978829250887001, 0.09500333716639608, 0.08051398135901511, 0.06632485517829634, 0.05243992913273676, 0.0388625398501844, 0.025595416163812335, 0.012640705437667377, 0.0, 0.012297178897820449, 0.024231607870467853, 0.035817080952429414, 0.047066803554496106, 0.0579934232420366, 0.06860905878204404, 0.07892532757083082, 0.08895337154667038, 0.09870388168469235, 0.10818712116487161, 0.11741294729798246, 0.1263908322888716, 0.13512988291130357, 0.14363885916392705, 0.15192619197256263, 0.16000000000000003, 0.16786810562079257, 0.17553805011512935, 0.1830171081327283, 0.19031230147480716, 0.1974304122395535, 0.20437799537408907, 0.2111613906737272, 0.21778673426731443, 0.22425996962564532, 0.13666364408000942, 0.12166594365318262, 0.10695280674870067, 0.09252959923652337, 0.07840100974843422, 0.06457107436534582, 0.051043201848028574, 0.03782019925651803, 0.024904297815852017, 0.012297178897820449, 0.0, 0.011962931446106051, 0.023576867462223206, 0.03485493447736043, 0.04580970612359225, 0.05645323186868145, 0.06679706405708552, 0.07685228346134843, 0.08662952343905239, 0.09613899278419857, 0.10539049735605444, 0.11439346056311339, 0.12315694277483291, 0.1316896597292101, 0.14, 0.1480960415834549, 0.15598556766083183, 0.16367608158957758, 0.1711748211730123, 0.17848877225550608, 0.1856246816875321, 0.19258906970260237, 0.1993882417459074, 0.2060282997925016, 0.2125151531910755, 0.14810937728375462, 0.13318745052055736, 0.11854458481714214, 0.10418619328572643, 0.09011701901524793, 0.07634115931234098, 0.06286209048809599, 0.04968269303759054, 0.03680527707143788, 0.024231607870467853, 0.011962931446106051, 0.0, 0.011637715493852951, 0.022939609492785507, 0.03391817686489462, 0.04458539316148735, 0.05495274126535765, 0.06503123657518961, 0.07483145081914, 0.08436353458450174, 0.09363723864465912, 0.10266193415928138, 0.11144663181883563, 0.12, 0.12833038199439217, 0.1364458123691905, 0.14435403251466683, 0.15206250543037447, 0.15957842979871173, 0.16690875339179478, 0.17406018585501737, 0.1810392109083182, 0.18785209800403357, 0.1945049134782436, 0.20100353123074066, 0.15921500441560665, 0.14436706052791826, 0.12979288625827157, 0.11549793843046885, 0.1014870107716952, 0.08776425773493368, 0.07433321886859079, 0.06119684358200661, 0.04835751616763695, 0.035817080952429414, 0.023576867462223206, 0.011637715493852951, 0.0, 0.011321289893970854, 0.02231937837884279, 0.033006162694671826, 0.04339305206180577, 0.05349099249323208, 0.06331049025998547, 0.07286163409455915, 0.08215411621171032, 0.09119725222091901, 0.09999999999999998, 0.10857097759498135, 0.11691848020728557, 0.12505049632549425, 0.13297472305550107, 0.14069858069964203, 0.14822922663243177, 0.1555735685178009, 0.1627382769102106, 0.16972979727971116, 0.1765543614988866, 0.18321799882769352, 0.1897265464304283, 0.16999417257484573, 0.15521839864640552, 0.140711306599559, 0.12647839368216696, 0.11252450068790854, 0.09885383538704273, 0.08546999650491072, 0.07237599809849116, 0.05957429419329541, 0.047066803554496106, 0.03485493447736043, 0.022939609492785507, 0.011321289893970854, 0.0, 0.011013419782306744, 0.02171572980330483, 0.032118261627646305, 0.04223188806581413, 0.0520670462871522, 0.06163375969304341, 0.07094165862782298, 0.07999999999999996, 0.08881768588172645, 0.09740328115015928, 0.10576503023038675, 0.11391087299591729, 0.12184845987932491, 0.1295851662425037, 0.13712810605307935, 0.1444841449108455, 0.15165991246562094, 0.15866181426565107, 0.16549604307358756, 0.1721685896851668, 0.1786852532839598, 0.18045993803550386, 0.1657545013888, 0.15131285563855457, 0.13714053539643745, 0.12324242518205786, 0.10962278248817314, 0.0962852613933145, 0.08323293657372044, 0.07046832757832522, 0.0579934232420366, 0.04580970612359225, 0.03391817686489462, 0.02231937837884279, 0.011013419782306744, 0.0, 0.010713876422412838, 0.021128230469882547, 0.03125385812694559, 0.04110112399838117, 0.05067998284871689, 0.06000000000000005, 0.06907037065874011, 0.07789993823840657, 0.08649721173967473, 0.09487038224673616, 0.10302733859439694, 0.11097568225736465, 0.11872274151004691, 0.12627558490234547, 0.1336410340942975, 0.1408256760899983, 0.14783587490899908, 0.15467778273132682, 0.16135735055037925, 0.16788033836622962, 0.1906247985973959, 0.17598784884217733, 0.1616099891427757, 0.1474967886268035, 0.13365317241541086, 0.12008344434830642, 0.10679131025503885, 0.09377990162595906, 0.08105179954803277, 0.06860905878204404, 0.05645323186868145, 0.04458539316148735, 0.033006162694671826, 0.02171572980330483, 0.010713876422412838, 0.0, 0.010422437053683398, 0.020556457861127253, 0.030412351179585295, 0.040000000000000036, 0.049328901628864386, 0.058408186718284405, 0.06724663730908298, 0.0758527039476996, 0.08423452193385683, 0.09239992675245678, 0.10035646873992432, 0.10811142703220655, 0.11567182283885702, 0.12304443208505977, 0.13023579746107472, 0.13725223991639135, 0.14409986963386134, 0.1507845965172221, 0.15731214022372453, 0.20050072409186415, 0.18593039487744656, 0.17161463874955873, 0.157559056702266, 0.14376861153591558, 0.13024765026665042, 0.11699992708022067, 0.10402862668499313, 0.09133638793071164, 0.07892532757083082, 0.06679706405708552, 0.05495274126535765, 0.04339305206180577, 0.032118261627646305, 0.021128230469882547, 0.010422437053683398, 0.0, 0.01013888474281155, 0.020000000000000018, 0.029593154019350143, 0.03892777325551022, 0.04801292110100108, 0.05685731564789476, 0.06546934653949676, 0.0738570909676658, 0.08202832886799027, 0.08999055736186468, 0.09775100449157526, 0.10531664229178317, 0.1126941992382755, 0.11989017211253028, 0.12691083731848762, 0.13376226168594418, 0.14045031279315578, 0.14698066883956218, 0.21009918516703407, 0.1955935956583622, 0.18133824018621714, 0.167338749146825, 0.15360012028611103, 0.14012674081776355, 0.12692241008284255, 0.11399036260727069, 0.10133329142510639, 0.08895337154667038, 0.07685228346134843, 0.06503123657518961, 0.05349099249323208, 0.04223188806581413, 0.03125385812694559, 0.020556457861127253, 0.01013888474281155, 0.0, 0.009863008238521598, 0.019458455215032422, 0.02879569385112657, 0.03788371772011734, 0.04673117852564301, 0.0553464026866024, 0.06373740708274334, 0.07191191401188335, 0.07987736540665191, 0.08764093635577297, 0.09520954797225123, 0.1025898796483613, 0.1097883807350637, 0.1168112816813659, 0.12366460466720142, 0.13035417376160763, 0.1368856246363367, 0.21943118046886867, 0.20498843656424015, 0.1907917599226675, 0.17684680805101682, 0.16315861108332252, 0.1497315936308884, 0.13656959717040607, 0.12367590282782503, 0.11105325442718272, 0.09870388168469235, 0.08662952343905239, 0.07483145081914, 0.06331049025998547, 0.0520670462871522, 0.04110112399838117, 0.030412351179585295, 0.020000000000000018, 0.009863008238521598, 0.0, 0.009594601829527094, 0.018931431909129492, 0.028019411576952646, 0.03686712384326907, 0.0454828297074793, 0.05387448365088454, 0.06204974835499488, 0.07001600869211555, 0.077780385032158, 0.08534974590702382, 0.09273072007150696, 0.09992970799743106, 0.10695289283567655, 0.11380625087884866, 0.12049556155557739, 0.1270264169858204, 0.2285072623264781, 0.21412545763292867, 0.19998572036114393, 0.18609373299814347, 0.1724545556728604, 0.1590726477612473, 0.14595189002511333, 0.13309560714377777, 0.12050659050902635, 0.10818712116487161, 0.09613899278419857, 0.08436353458450174, 0.07286163409455915, 0.06163375969304341, 0.05067998284871689, 0.040000000000000036, 0.029593154019350143, 0.019458455215032422, 0.009594601829527094, 0.0, 0.009333465205665359, 0.018418548332056806, 0.027263761524024543, 0.03587729829091035, 0.04426704874571907, 0.05244061408382117, 0.06040532034680379, 0.06816823151435258, 0.07573616196451771, 0.08311568834036476, 0.09031316085883623, 0.09733471409563177, 0.10418627727804974, 0.11087358411600845, 0.1174021821998742, 0.23733756104294101, 0.22301477762351496, 0.2089302236606846, 0.19508960464106861, 0.1814980084482759, 0.1681599267455226, 0.15507927688694034, 0.14225942421796955, 0.12970320463657847, 0.11741294729798246, 0.10539049735605444, 0.09363723864465912, 0.08215411621171032, 0.07094165862782298, 0.06000000000000005, 0.049328901628864386, 0.03892777325551022, 0.02879569385112657, 0.018931431909129492, 0.009333465205665359, 0.0, 0.009079403322160506, 0.017919432356647502, 0.02652821117488291, 0.03491356366660425, 0.04308302777852946, 0.05104386905112268, 0.05880309349529966, 0.06636745984843995, 0.07374349124678059, 0.08093748634913833, 0.08795552994493727, 0.09480350307769081, 0.1014870927134015, 0.10801180098177621, 0.24593180788628966, 0.23166611679174565, 0.21763497428769207, 0.20384410701918831, 0.1902986285265802, 0.17700306042772096, 0.16396135412309232, 0.1511769128854954, 0.1386526142072687, 0.1263908322888716, 0.11439346056311339, 0.10266193415928138, 0.09119725222091901, 0.07999999999999996, 0.06907037065874011, 0.058408186718284405, 0.04801292110100108, 0.03788371772011734, 0.028019411576952646, 0.018418548332056806, 0.009079403322160506, 0.0, 0.00883222626696234, 0.017433721258753643, 0.02581224089998213, 0.033975258231973116, 0.041929976722325346, 0.04968334292639165, 0.057242058539080154, 0.06461259187313773, 0.07180118879800157, 0.07881388317137361, 0.08565650679389603, 0.09233469891564272, 0.09885391532162002, 0.2542993568692259, 0.2400888184651695, 0.2261093003779937, 0.2123665486994185, 0.19886570066067677, 0.18561130563607242, 0.17260734666289335, 0.15985726234059439, 0.14736396898339943, 0.13512988291130357, 0.12315694277483291, 0.11144663181883563, 0.09999999999999998, 0.08881768588172645, 0.07789993823840657, 0.06724663730908298, 0.05685731564789476, 0.04673117852564301, 0.03686712384326907, 0.027263761524024543, 0.017919432356647502, 0.00883222626696234, 0.0, 0.008591749131112825, 0.01696106150096366, 0.02511534369282553, 0.03306173562688097, 0.04080712300662337, 0.04835814916666148, 0.05572122635719079, 0.06290254649836824, 0.06990809143594356, 0.07674364272775946, 0.08341479098911342, 0.08992694482347752, 0.2624492054005747, 0.2482918694995232, 0.2343621739904359, 0.22066588281973554, 0.20720815506604517, 0.1939935657865055, 0.1810261273721453, 0.1683093112764309, 0.1558460699923211, 0.14363885916392705, 0.1316896597292101, 0.12, 0.10857097759498135, 0.09740328115015928, 0.08649721173967473, 0.0758527039476996, 0.06546934653949676, 0.0553464026866024, 0.0454828297074793, 0.03587729829091035, 0.02652821117488291, 0.017433721258753643, 0.008591749131112825, 0.0, 0.008357791882086962, 0.016501108520097008, 0.024437024907835503, 0.03217236458975237, 0.039713711305131794, 0.0470674200791944, 0.05423962779351532, 0.06123626326632314, 0.06806305687154446, 0.0747255497238738, 0.08122910245568593, 0.2703900138863711, 0.25628391969284725, 0.24240223032708952, 0.22875072610893554, 0.21533458623392387, 0.20215840948352792, 0.1892262354363774, 0.1765415660457771, 0.16410738745999864, 0.15192619197256263, 0.14, 0.12833038199439217, 0.11691848020728557, 0.10576503023038675, 0.09487038224673616, 0.08423452193385683, 0.0738570909676658, 0.06373740708274334, 0.05387448365088454, 0.04426704874571907, 0.03491356366660425, 0.02581224089998213, 0.01696106150096366, 0.008357791882086962, 0.0, 0.0081301792400581, 0.016053526518483352, 0.023776802001110098, 0.031306528678388124, 0.038649003263700576, 0.04581030658046714, 0.05279631346782532, 0.059612702233018955, 0.06626496367707768, 0.07275840971893999, 0.27813012435381146, 0.2640733002292195, 0.25023778599060065, 0.23662937695179953, 0.2232532707988386, 0.2101140881850172, 0.19721589381815208, 0.18456221790642902, 0.17215607784048026, 0.16000000000000003, 0.1480960415834549, 0.1364458123691905, 0.12505049632549425, 0.11391087299591729, 0.10302733859439694, 0.09239992675245678, 0.08202832886799027, 0.07191191401188335, 0.06204974835499488, 0.05244061408382117, 0.04308302777852946, 0.033975258231973116, 0.02511534369282553, 0.016501108520097008, 0.0081301792400581, 0.0, 0.007908740557035387, 0.015617988259027049, 0.02313420427420143, 0.03046362599161878, 0.03761227722572236, 0.044585977948215505, 0.05139035357467614, 0.058030843831810563, 0.06451271122984847, 0.2856775781670394, 0.2716680412197705, 0.2578768563450641, 0.24430983256475158, 0.2309721845242778, 0.21786855299344976, 0.20500302584968133, 0.19237915941135053, 0.17999999999999994, 0.16786810562079257, 0.15598556766083183, 0.14435403251466683, 0.13297472305550107, 0.12184845987932491, 0.11097568225736465, 0.10035646873992432, 0.08999055736186468, 0.07987736540665191, 0.07001600869211555, 0.06040532034680379, 0.05104386905112268, 0.041929976722325346, 0.03306173562688097, 0.024437024907835503, 0.016053526518483352, 0.007908740557035387, 0.0, 0.00769330969882287, 0.015194174864053722, 0.022508772621039896, 0.02964306889210444, 0.03660282795552994, 0.04339362156736215, 0.050020837671265084, 0.05648968872029281, 0.2930401328998541, 0.2790758884048167, 0.2653271720429976, 0.25179980534334645, 0.23849901846661892, 0.22542947063244279, 0.21259527101841935, 0.19999999999999996, 0.18764673061098236, 0.17553805011512935, 0.16367608158957758, 0.15206250543037447, 0.14069858069964203, 0.1295851662425037, 0.11872274151004691, 0.10811142703220655, 0.09775100449157526, 0.08764093635577297, 0.077780385032158, 0.06816823151435258, 0.05880309349529966, 0.04968334292639165, 0.04080712300662337, 0.03217236458975237, 0.023776802001110098, 0.015617988259027049, 0.00769330969882287, 0.0, 0.0074837249297470265, 0.014781775617927817, 0.02190005927811245, 0.028844283730570797, 0.03561996636030573, 0.04223244267059878, 0.048686874455311724, 0.3002252784269185, 0.28630431907744613, 0.27259619477753494, 0.2591067384394986, 0.24584119437402252, 0.23280423866415034, 0.21999999999999997, 0.2074320808440594, 0.19510357880801898, 0.1830171081327283, 0.1711748211730123, 0.15957842979871173, 0.14822922663243177, 0.13712810605307935, 0.12627558490234547, 0.11567182283885702, 0.10531664229178317, 0.09520954797225123, 0.08534974590702382, 0.07573616196451771, 0.06636745984843995, 0.057242058539080154, 0.04835814916666148, 0.039713711305131794, 0.031306528678388124, 0.02313420427420143, 0.015194174864053722, 0.0074837249297470265, 0.0, 0.0072798288001023614, 0.01438048777342893, 0.021307627577990984, 0.028066710571745257, 0.03466301921098047, 0.04110166407434779, 0.30724025229186536, 0.29336055728573895, 0.27969113231581777, 0.2662378206232491, 0.2530058793739304, 0.24, 0.22722432898987766, 0.21468248899780662, 0.20237760015496198, 0.19031230147480716, 0.17848877225550608, 0.16690875339179478, 0.1555735685178009, 0.1444841449108455, 0.1336410340942975, 0.12304443208505977, 0.1126941992382755, 0.1025898796483613, 0.09273072007150696, 0.08311568834036476, 0.07374349124678059, 0.06461259187313773, 0.05572122635719079, 0.0470674200791944, 0.038649003263700576, 0.03046362599161878, 0.022508772621039896, 0.014781775617927817, 0.0072798288001023614, 0.0, 0.0070814680362643045, 0.013990016361868585, 0.020731051706297965, 0.02730980292223606, 0.03373132886256547, 0.3140920544078526, 0.30025158836795585, 0.28661895286672934, 0.2732000004810501, 0.26, 0.24702365675448057, 0.234275133382281, 0.22175807090065802, 0.20947560996959846, 0.1974304122395535, 0.1856246816875321, 0.17406018585501737, 0.1627382769102106, 0.15165991246562094, 0.1408256760899983, 0.13023579746107472, 0.11989017211253028, 0.1097883807350637, 0.09992970799743106, 0.09031316085883623, 0.08093748634913833, 0.07180118879800157, 0.06290254649836824, 0.05423962779351532, 0.04581030658046714, 0.03761227722572236, 0.02964306889210444, 0.02190005927811245, 0.01438048777342893, 0.0070814680362643045, 0.0, 0.006888493433416243, 0.01361007400692571, 0.020169916462179915, 0.02657302746057877, 0.32078746114358403, 0.3069841728724857, 0.29338639883356965, 0.28, 0.26683025560677776, 0.2538818834891784, 0.24115906084259242, 0.22866544527693566, 0.21640419604992034, 0.20437799537408907, 0.19258906970260237, 0.1810392109083182, 0.16972979727971116, 0.15866181426565107, 0.14783587490899908, 0.13725223991639135, 0.12691083731848762, 0.1168112816813659, 0.10695289283567655, 0.09733471409563177, 0.08795552994493727, 0.07881388317137361, 0.06990809143594356, 0.06123626326632314, 0.05279631346782532, 0.044585977948215505, 0.03660282795552994, 0.028844283730570797, 0.021307627577990984, 0.013990016361868585, 0.006888493433416243, 0.0, 0.006700759750842056, 0.013240380742175928, 0.019623817022355605, 0.32733303884557974, 0.3135648599120886, 0.30000000000000004, 0.2866443275851934, 0.27350313121813863, 0.26058113989198517, 0.24788254381700447, 0.2354110154756669, 0.22316973084378056, 0.2111613906737272, 0.1993882417459074, 0.18785209800403357, 0.1765543614988866, 0.16549604307358756, 0.15467778273132682, 0.14409986963386134, 0.13376226168594418, 0.12366460466720142, 0.11380625087884866, 0.10418627727804974, 0.09480350307769081, 0.08565650679389603, 0.07674364272775946, 0.06806305687154446, 0.059612702233018955, 0.05139035357467614, 0.04339362156736215, 0.03561996636030573, 0.028066710571745257, 0.020731051706297965, 0.01361007400692571, 0.006700759750842056, 0.0, 0.00651812560973164, 0.012880663832286365, 0.3337351568455398, 0.32000000000000006, 0.3064660861955927, 0.29313929055533106, 0.2800249098534928, 0.2671276829343724, 0.2544518115212786, 0.24200098129119918, 0.22977838310170873, 0.21778673426731443, 0.2060282997925016, 0.1945049134782436, 0.18321799882769352, 0.1721685896851668, 0.16135735055037925, 0.1507845965172221, 0.14045031279315578, 0.13035417376160763, 0.12049556155557739, 0.11087358411600845, 0.1014870927134015, 0.09233469891564272, 0.08341479098911342, 0.0747255497238738, 0.06626496367707768, 0.058030843831810563, 0.050020837671265084, 0.04223244267059878, 0.03466301921098047, 0.02730980292223606, 0.020169916462179915, 0.013240380742175928, 0.00651812560973164, 0.0, 0.006340453393450907};

// Nonnegative integer exponentiation function
// Based on Wikipedia's algorithm for "Exponentiation by Squaring"
double int_pow(double base, int exponent) {
    // Nonpositive case; negative exponents are treated as 0.
    if (exponent <= 0) return 1;

    // Variable to store factors produced in odd exponent cases
    double y = 1;

    while (exponent > 1) {
        if (exponent % 2 == 0) {
            // Even case, so we square the base here
            base *= base;
            exponent /= 2;
        }
        else {
            // Odd case, so we take extract one factor to get
            // back to the even case and then deal with that here
            y *= base;
            base *= base;
            exponent = (exponent - 1) / 2;
        }
    }

    return base * y;
}

#define REPEATER(x) REPEAT_ ## x
#define SHIFTER(dir) SHIFT_ ## dir
#define FILTER(dir) dir ## _FILTER

// Find legal moves function
// Returns a bitboard of legal moves
// It will find the legal moves for the color of 
// the first argument (called black in the function)
u64 findLegalMoves(u64 black, u64 white) {
    u64 moves = 0;
    u64 w, t;

    // TODO: Try out Kogge-Stone Algorithm here
    // See https://www.chessprogramming.org/Kogge-Stone_Algorithm

    #define LM_DIR_ALG(dir) \
    w = white & FILTER(dir);\
    t = w & SHIFTER(dir)(black);\
    if (t) {\
        REPEAT_5(t |= w & SHIFTER(dir)(t))\
        moves |= FILTER(dir) & SHIFTER(dir)(t);\
    }

    LM_DIR_ALG(RIGHT)
    LM_DIR_ALG(LEFT)
    LM_DIR_ALG(UP)
    LM_DIR_ALG(DOWN)
    LM_DIR_ALG(UP_RIGHT)
    LM_DIR_ALG(UP_LEFT)
    LM_DIR_ALG(DOWN_RIGHT)
    LM_DIR_ALG(DOWN_LEFT)

    return moves & ~(white | black);
}

// Makes a move for the color of
// the first argument (called black in the function)
// Assumes move is not in central 4 squares, which is 
// impossible in a typical game (if you don't want this behavior, uncomment
// the two if 0 blocks below)
u64 doMove(u64 black, u64 white, u8 square) {
    u64 bi = BIT(square);
    u64 newblack = black;
    u64 filtered, n;
    
    #define DMB(x, dir) \
    n = bi;\
    filtered = white & FILTER(dir);\
    n |= filtered & SHIFTER(dir)(n);\
    if (n != bi) {\
        REPEATER(x)(n |= filtered & SHIFTER(dir)(n));\
        C_OR(black & FILTER(dir) & SHIFTER(dir)(n), newblack, n);\
    }
    // Perhaps these shouldn't be overloaded
    #define RIGHT(x) DMB(x, RIGHT)
    #define DOWN(x) DMB(x, DOWN)
    #define DOWN_RIGHT(x) DMB(x, DOWN_RIGHT)
    #define DOWN_LEFT(x) DMB(x, DOWN_LEFT)
    #define UP(x) DMB(x, UP)
    #define UP_LEFT(x) DMB(x, UP_LEFT)
    #define UP_RIGHT(x) DMB(x, UP_RIGHT)
    #define LEFT(x) DMB(x, LEFT)

    switch (square) {
        case 0:
            RIGHT(6)
            DOWN(6)
            DOWN_RIGHT(6)
            return newblack;
        case 1:
            RIGHT(5)
            DOWN(6)
            DOWN_RIGHT(5)
            return newblack;
        case 2:
            RIGHT(4)
            DOWN(6)
            DOWN_RIGHT(4)
            DOWN_LEFT(1)
            LEFT(1)
            return newblack;
        case 3:
            RIGHT(3)
            DOWN(6)
            DOWN_RIGHT(3)
            DOWN_LEFT(2)
            LEFT(2)
            return newblack;
        case 4:
            RIGHT(2)
            DOWN(6)
            DOWN_RIGHT(2)
            DOWN_LEFT(3)
            LEFT(3)
            return newblack;
        case 5:
            RIGHT(1)
            DOWN(6)
            DOWN_RIGHT(1)
            DOWN_LEFT(4)
            LEFT(4)
            return newblack;
        case 6:
            DOWN(6)
            DOWN_LEFT(5)
            LEFT(5)
            return newblack;
        case 7:
            DOWN(6)
            DOWN_LEFT(6)
            LEFT(6)
            return newblack;
        case 8:
            RIGHT(6)
            DOWN(5)
            DOWN_RIGHT(5)
            return newblack;
        case 9:
            RIGHT(5)
            DOWN(5)
            DOWN_RIGHT(5)
            return newblack;
        case 10:
            RIGHT(4)
            DOWN(5)
            DOWN_RIGHT(4)
            DOWN_LEFT(1)
            LEFT(1)
            return newblack;
        case 11:
            RIGHT(3)
            DOWN(5)
            DOWN_RIGHT(3)
            DOWN_LEFT(2)
            LEFT(2)
            return newblack;
        case 12:
            RIGHT(2)
            DOWN(5)
            DOWN_RIGHT(2)
            DOWN_LEFT(3)
            LEFT(3)
            return newblack;
        case 13:
            RIGHT(1)
            DOWN(5)
            DOWN_RIGHT(1)
            DOWN_LEFT(4)
            LEFT(4)
            return newblack;
        case 14:
            DOWN(5)
            DOWN_LEFT(5)
            LEFT(5)
            return newblack;
        case 15:
            DOWN(5)
            DOWN_LEFT(5)
            LEFT(6)
            return newblack;
        case 16:
            RIGHT(6)
            DOWN(4)
            DOWN_RIGHT(4)
            UP(1)
            UP_RIGHT(1)
            return newblack;
        case 17:
            RIGHT(5)
            DOWN(4)
            DOWN_RIGHT(4)
            UP(1)
            UP_RIGHT(1)
            return newblack;
        case 18:
            RIGHT(4)
            DOWN(4)
            DOWN_RIGHT(4)
            DOWN_LEFT(1)
            LEFT(1)
            UP(1)
            UP_LEFT(1)
            UP_RIGHT(1)
            return newblack;
        case 19:
            RIGHT(3)
            DOWN(4)
            DOWN_RIGHT(3)
            DOWN_LEFT(2)
            LEFT(2)
            UP(1)
            UP_LEFT(1)
            UP_RIGHT(1)
            return newblack;
        case 20:
            RIGHT(2)
            DOWN(4)
            DOWN_RIGHT(2)
            DOWN_LEFT(3)
            LEFT(3)
            UP(1)
            UP_LEFT(1)
            UP_RIGHT(1)
            return newblack;
        case 21:
            RIGHT(1)
            DOWN(4)
            DOWN_RIGHT(1)
            DOWN_LEFT(4)
            LEFT(4)
            UP(1)
            UP_LEFT(1)
            UP_RIGHT(1)
            return newblack;
        case 22:
            DOWN(4)
            DOWN_LEFT(4)
            LEFT(5)
            UP(1)
            UP_LEFT(1)
            return newblack;
        case 23:
            DOWN(4)
            DOWN_LEFT(4)
            LEFT(6)
            UP(1)
            UP_LEFT(1)
            return newblack;
        case 24:
            RIGHT(6)
            DOWN(3)
            DOWN_RIGHT(3)
            UP(2)
            UP_RIGHT(2)
            return newblack;
        case 25:
            RIGHT(5)
            DOWN(3)
            DOWN_RIGHT(3)
            UP(2)
            UP_RIGHT(2)
            return newblack;
        case 26:
            RIGHT(4)
            DOWN(3)
            DOWN_RIGHT(3)
            DOWN_LEFT(1)
            LEFT(1)
            UP(2)
            UP_LEFT(1)
            UP_RIGHT(2)
            return newblack;
        #if 0
        case 27:
            RIGHT(3)
            DOWN(3)
            DOWN_RIGHT(3)
            DOWN_LEFT(2)
            LEFT(2)
            UP(2)
            UP_LEFT(2)
            UP_RIGHT(2)
            return newblack;
        case 28:
            RIGHT(2)
            DOWN(3)
            DOWN_RIGHT(2)
            DOWN_LEFT(3)
            LEFT(3)
            UP(2)
            UP_LEFT(2)
            UP_RIGHT(2)
            return newblack;
        #endif
        case 29:
            RIGHT(1)
            DOWN(3)
            DOWN_RIGHT(1)
            DOWN_LEFT(3)
            LEFT(4)
            UP(2)
            UP_LEFT(2)
            UP_RIGHT(1)
            return newblack;
        case 30:
            DOWN(3)
            DOWN_LEFT(3)
            LEFT(5)
            UP(2)
            UP_LEFT(2)
            return newblack;
        case 31:
            DOWN(3)
            DOWN_LEFT(3)
            LEFT(6)
            UP(2)
            UP_LEFT(2)
            return newblack;
        case 32:
            RIGHT(6)
            UP(3)
            UP_RIGHT(3)
            DOWN(2)
            DOWN_RIGHT(2)
            return newblack;
        case 33:
            RIGHT(5)
            UP(3)
            UP_RIGHT(3)
            DOWN(2)
            DOWN_RIGHT(2)
            return newblack;
        case 34:
            RIGHT(4)
            UP(3)
            UP_RIGHT(3)
            UP_LEFT(1)
            LEFT(1)
            DOWN(2)
            DOWN_LEFT(1)
            DOWN_RIGHT(2)
            return newblack;
        #if 0
        case 35:
            RIGHT(3)
            UP(3)
            UP_RIGHT(3)
            UP_LEFT(2)
            LEFT(2)
            DOWN(2)
            DOWN_LEFT(2)
            DOWN_RIGHT(2)
            return newblack;
        case 36:
            RIGHT(2)
            UP(3)
            UP_RIGHT(2)
            UP_LEFT(3)
            LEFT(3)
            DOWN(2)
            DOWN_LEFT(2)
            DOWN_RIGHT(2)
            return newblack;
        #endif
        case 37:
            RIGHT(1)
            UP(3)
            UP_RIGHT(1)
            UP_LEFT(3)
            LEFT(4)
            DOWN(2)
            DOWN_LEFT(2)
            DOWN_RIGHT(1)
            return newblack;
        case 38:
            UP(3)
            UP_LEFT(3)
            LEFT(5)
            DOWN(2)
            DOWN_LEFT(2)
            return newblack;
        case 39:
            UP(3)
            UP_LEFT(3)
            LEFT(6)
            DOWN(2)
            DOWN_LEFT(2)
            return newblack;
        case 40:
            RIGHT(6)
            UP(4)
            UP_RIGHT(4)
            DOWN(1)
            DOWN_RIGHT(1)
            return newblack;
        case 41:
            RIGHT(5)
            UP(4)
            UP_RIGHT(4)
            DOWN(1)
            DOWN_RIGHT(1)
            return newblack;
        case 42:
            RIGHT(4)
            UP(4)
            UP_RIGHT(4)
            UP_LEFT(1)
            LEFT(1)
            DOWN(1)
            DOWN_LEFT(1)
            DOWN_RIGHT(1)
            return newblack;
        case 43:
            RIGHT(3)
            UP(4)
            UP_RIGHT(3)
            UP_LEFT(2)
            LEFT(2)
            DOWN(1)
            DOWN_LEFT(1)
            DOWN_RIGHT(1)
            return newblack;
        case 44:
            RIGHT(2)
            UP(4)
            UP_RIGHT(2)
            UP_LEFT(4)
            LEFT(3)
            DOWN(1)
            DOWN_LEFT(1)
            DOWN_RIGHT(1)
            return newblack;
        case 45:
            RIGHT(1)
            UP(4)
            UP_RIGHT(1)
            UP_LEFT(4)
            LEFT(4)
            DOWN(1)
            DOWN_LEFT(1)
            DOWN_RIGHT(1)
            return newblack;
        case 46:
            UP(4)
            UP_LEFT(4)
            LEFT(5)
            DOWN(1)
            DOWN_LEFT(1)
            return newblack;
        case 47:
            UP(4)
            UP_LEFT(4)
            LEFT(6)
            DOWN(1)
            DOWN_LEFT(1)
            return newblack;
        case 48:
            RIGHT(6)
            UP(5)
            UP_RIGHT(5)
            return newblack;
        case 49:
            RIGHT(5)
            UP(5)
            UP_RIGHT(5)
            return newblack;
        case 50:
            RIGHT(4)
            UP(5)
            UP_RIGHT(4)
            UP_LEFT(1)
            LEFT(1)
            return newblack;
        case 51:
            RIGHT(3)
            UP(5)
            UP_RIGHT(3)
            UP_LEFT(2)
            LEFT(2)
            return newblack;
        case 52:
            RIGHT(2)
            UP(5)
            UP_RIGHT(2)
            UP_LEFT(3)
            LEFT(3)
            return newblack;
        case 53:
            RIGHT(1)
            UP(5)
            UP_RIGHT(1)
            UP_LEFT(4)
            LEFT(4)
            return newblack;
        case 54:
            UP(5)
            UP_LEFT(5)
            LEFT(5)
            return newblack;
        case 55:
            UP(5)
            UP_LEFT(5)
            LEFT(6)
            return newblack;
        case 56:
            RIGHT(6)
            UP(6)
            UP_RIGHT(6)
            return newblack;
        case 57:
            RIGHT(5)
            UP(6)
            UP_RIGHT(5)
            return newblack;
        case 58:
            RIGHT(4)
            UP(6)
            UP_RIGHT(4)
            UP_LEFT(1)
            LEFT(1)
            return newblack;
        case 59:
            RIGHT(3)
            UP(6)
            UP_RIGHT(3)
            UP_LEFT(2)
            LEFT(2)
            return newblack;
        case 60:
            RIGHT(2)
            UP(6)
            UP_RIGHT(2)
            UP_LEFT(3)
            LEFT(3)
            return newblack;
        case 61:
            RIGHT(1)
            UP(6)
            UP_RIGHT(1)
            UP_LEFT(4)
            LEFT(4)
            return newblack;
        case 62:
            UP(6)
            UP_LEFT(5)
            LEFT(5)
            return newblack;
        case 63:
            UP(6)
            UP_LEFT(6)
            LEFT(6)
            return newblack;
    }

    return 0; // To signal an error
}

u64 frontier(u64 black, u64 white) {
    u64 empty = ~(black | white);
    u64 frontierBlack = SHIFT_RIGHT(empty) & (RIGHT_FILTER & LEFT_FILTER) & black;
    frontierBlack |= SHIFT_LEFT(empty) & (LEFT_FILTER & RIGHT_FILTER) & black;
    frontierBlack |= SHIFT_UP(empty) & (UP_FILTER & DOWN_FILTER) & black;
    frontierBlack |= SHIFT_DOWN(empty) & (DOWN_FILTER & UP_FILTER) & black;
    frontierBlack |= SHIFT_UP_RIGHT(empty) & ~EDGES & black;
    frontierBlack |= SHIFT_UP_LEFT(empty) & ~EDGES & black;
    frontierBlack |= SHIFT_DOWN_RIGHT(empty) & ~EDGES & black;
    frontierBlack |= SHIFT_DOWN_LEFT(empty) & ~EDGES & black;
    return frontierBlack;
}

double frontierScore(u64 black, u64 white, u64 poison) {
    u64 taken = black | white;
    u64 empty = ~(black | white);
    u64 nonedgeBlack = ~EDGES & black;
    u64 nonLR = (RIGHT_FILTER & LEFT_FILTER) & black;
    u64 nonUD = (UP_FILTER & DOWN_FILTER) & black;

    // Normal frontier
    u64 frontierBlack = SHIFT_RIGHT(empty) & nonLR;
    frontierBlack |= SHIFT_LEFT(empty) & nonLR;
    frontierBlack |= SHIFT_UP(empty) & nonUD;
    frontierBlack |= SHIFT_DOWN(empty) & nonUD;
    frontierBlack |= SHIFT_UP_RIGHT(empty) & nonedgeBlack;
    frontierBlack |= SHIFT_UP_LEFT(empty) & nonedgeBlack;
    frontierBlack |= SHIFT_DOWN_RIGHT(empty) & nonedgeBlack;
    frontierBlack |= SHIFT_DOWN_LEFT(empty) & nonedgeBlack;

    // Exclude poison squares for weighted frontier
    empty &= ~poison;

    // Calculate weighted frontier
    int result = PC(SHIFT_RIGHT(empty) & nonLR);
    result += PC(SHIFT_LEFT(empty) & nonLR);
    result += PC(SHIFT_UP(empty) & nonUD);
    result += PC(SHIFT_DOWN(empty) & nonUD);
    result += PC(SHIFT_UP_RIGHT(empty) & nonedgeBlack);
    result += PC(SHIFT_UP_LEFT(empty) & nonedgeBlack);
    result += PC(SHIFT_DOWN_RIGHT(empty) & nonedgeBlack);
    result += PC(SHIFT_DOWN_LEFT(empty) & nonedgeBlack);
    u64 fro = frontierBlack;
    u64 internal = black & ~fro;
    return (result - 4 * PC(internal & ~EDGES) - 2 * PC(internal & EDGES)) / (3 * PC(taken)) + PC(fro) / 8.0;
}

// Evaluate position to int
// Assumes the first argument is to move
// Also assumes a wipeout has not occurred, and that there is a legal move
int eval(u64 black, u64 white, u64 lmBlack) {
    // To avoid worrying about keeping this code the same three times in this function 
    // and the next two, it will be included in (in an admittedly odd usage of #include).
    #include "eval_code.c"
    return ee / (1 + eeSumAbs / 400);
}

// Print eval information for debugging
void printEvalToFile(FILE *f, u64 black, u64 white) {
    u64 lmBlack = findLegalMoves(black, white);
    #include "eval_code.c"
    fprintf(f, "frontier: %f\n", frontierWeight * eeF);
    fprintf(f, "mobility: %f\n", mobilityWeight * eeM);
    fprintf(f, "corners: %f\n", cornerWeight * eeC);
    fprintf(f, "ee %f\n", ee);
    fprintf(f, "factor %f\n", 1 / (1 + eeSumAbs / 400));
    fprintf(f, "Actual eval: %d\n", EVAL(black, white));
}
    
void printEval(u64 black, u64 white) {
    printEvalToFile(stdout, black, white);
}

void printEval2(u64 black, u64 white) {
    printEvalToFile(stderr, black, white);
}

// Print board
void printBoardToFile(FILE *f, u64 black, u64 white) {
    char s[200];
    u8 nextIndex = 0;
    fprintf(f, "+--------+\n");
    for (u8 i = 0; i < 8; i++) {
        s[nextIndex++] = '|';
        for (u8 j = 0; j < 8; j++) {
            if (GET(black, j, i)) s[nextIndex++] = 'X';
            else if (GET(white, j, i)) s[nextIndex++] = 'O';
            else s[nextIndex++] = ' ';
        }
        s[nextIndex++] = '|';
        s[nextIndex++] = '\n';
    }
    s[nextIndex] = '\0';

    fprintf(f, "%s", s);
    fprintf(f, "+--------+\n");
}

void printBoard(u64 black, u64 white) {
    printBoardToFile(stdout, black, white);
}

void printBoard2(u64 black, u64 white) {
    printBoardToFile(stderr, black, white);
}
